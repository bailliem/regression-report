# Bacteremia study  {#Bacteremia}

```{r, echo=FALSE, warning=FALSE, message=FALSE, echo=FALSE}
## Load libraries for this chapter
library(here)
library(tidyverse)
library(Hmisc)
```



## Overview of the bacteremia study  CHANGED SUBHEADER

We will exemplify our proposed systematic approach to data screening by means of a diagnostic study with the primary aim of using age, sex and 49 laboratory variables to fit a diagnostic prediction model for the bacteremia status (= presence of bacteria in the blood stream) of a blood sample. A secondary aim of the study is to describe the functional form of each predictor in the model. Between January 2006 and December 2010, patients with the clinical suspicion to suffer from bacteremia were included if blood culture analysis was requested by the responsible physician and blood was sampled for assessment of hematology and biochemistry. An analysis of this study can be found in Ratzinger et al: "A Risk Prediction Model for Screening Bacteremic Patients: A Cross Sectional Study"  [Ratzinger et al, PLoS One 2014](https://doi.org/10.1371/journal.pone.0106765).

The data consists of 14,691 observations from different patients and 51 potential predictors. To protect data privacy our version of this data was slightly modified compared to the original version, and this modified version was cleared by the Medical University of Vienna for public use (DC 2019-0054). Compared to the official results given in Ratzinger et al (2014), our results may differ to a negligible degree. 


### Source dataset  CHANGED Hierarchy to third level

We refer to the source data set as the dataset available in this repository.

Display the source dataset contents. This dataset is in the **data** folder of the project directory. 

```{r contents_bact,  warning=FALSE, message=FALSE, echo=FALSE, results='asis'} 
## Load the dataset from the data folder. 

bact<-read.csv(here::here("data", "Bacteremia_public_S2.csv"))

Hmisc::html(Hmisc::contents(bact),
            maxlevels = 10,
            levelType = 'table')

bact.dd<-read.csv(here::here("misc", "bacteremia-DataDictionary.csv"))

#bact.dd
```


### Updated analysis dataset

Additional meta-data is added to the original *source* data set. We write this new modified (annotated) data set back to the **data** folder after adding additional meta-data for all variables. The meta-data is taken from the data dictionary.

At the stage we could select the variables of interest to take in to the IDA phase by dropping variables we do not check in IDA.

As a cross check we display the contents again to ensure the additional data is added, and then write  the changes to the data folder in the file "data/a_bact.rda". 

```{r contents_abact, warning=FALSE, message=FALSE, echo=FALSE, results='asis'} 

### COMMENT: I removed the definition of a bact_subset as we don't need it anymore! (this comment can be deleted)

## Complete metadata by adding missing labels. 
## Generate a derived dataset stored in data as we are adding to the original source dataset obtained. 


labels_list <- bact.dd$Label
units_list <- bact.dd$Units

names(labels_list) <- names(units_list) <- bact.dd$Variable

## Complete metadata by adding missing labels.
a_bact <- Hmisc::upData(
  bact,
  labels = labels_list[names(bact_subset)], units=units_list[names(bact_subset)])

## Derive outcome variable
a_bact$BC <-   as.numeric(a_bact$BloodCulture=="yes")+0


## Add meta data
a_bact <- Hmisc::upData(a_bact ,
               labels = c(BC = 'bacteremia'), units = c(BC = '0/1'))


## Display contents
Hmisc::html(Hmisc::contents(a_bact),
            maxlevels = 10,
            levelType = 'table')

## Write to data folder
save(a_bact, file = here::here("data", "a_bact.rda"))
```

## Section session info

```{r, warning=FALSE, message=FALSE, echo=FALSE}
sessionInfo()
```



